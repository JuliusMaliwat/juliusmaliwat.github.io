---
// Project landing page: rich, single-project narrative.
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Nav from "../../components/Nav.astro";
import Footer from "../../components/Footer.astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  const published = projects.filter((project) => !project.data.draft);
  return published.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();
const profileEntry = (await getCollection("profile"))[0];
const profile = profileEntry?.data;
---

<BaseLayout title={project.data.title} description={project.data.summary}>
  <main>
    <Nav />

    <section>
      <div class="eyebrow">{project.data.type}</div>
      <h1 class="hero-title">{project.data.title}</h1>
      <p class="lead">{project.data.summary}</p>
      {project.data.tech?.length && (
        <div class="nav-links">
          {project.data.tech.map((tech) => (
            <span class="pill">{tech}</span>
          ))}
        </div>
      )}
      {project.data.links?.length && (
        <div class="nav-links" style="margin-top: 16px;">
          {project.data.links.map((link) => (
            <a href={link.url} target="_blank" rel="noreferrer">
              {link.label}
            </a>
          ))}
        </div>
      )}
    </section>

    <section>
      <h2>Overview</h2>
      {project.data.problem && (
        <p><strong>Problem:</strong> {project.data.problem}</p>
      )}
      {project.data.solution && (
        <p><strong>Solution:</strong> {project.data.solution}</p>
      )}
      {project.data.highlights?.length && (
        <ul>
          {project.data.highlights.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      )}
    </section>

    <section>
      <h2>Details</h2>
      <Content />
    </section>

    <Footer email={profile?.email} location={profile?.location} links={profile?.links} />
  </main>
</BaseLayout>
